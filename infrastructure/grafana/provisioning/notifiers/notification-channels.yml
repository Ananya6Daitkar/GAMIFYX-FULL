apiVersion: 1

notifiers:
  - name: slack-alerts
    type: slack
    uid: slack-alerts
    org_id: 1
    is_default: true
    send_reminder: true
    disable_resolve_message: false
    frequency: "10s"
    settings:
      url: "${SLACK_WEBHOOK_URL}"
      channel: "#aiops-alerts"
      username: "Grafana"
      title: "AIOps Platform Alert"
      text: |
        {{ range .Alerts }}
        **Alert:** {{ .Annotations.summary }}
        **Description:** {{ .Annotations.description }}
        **Severity:** {{ .Labels.severity }}
        **Team:** {{ .Labels.team }}
        **Status:** {{ .Status }}
        {{ end }}
      iconEmoji: ":exclamation:"
      iconUrl: ""

  - name: email-alerts
    type: email
    uid: email-alerts
    org_id: 1
    is_default: false
    send_reminder: true
    disable_resolve_message: false
    frequency: "10s"
    settings:
      addresses: "${ALERT_EMAIL_ADDRESSES}"
      subject: "AIOps Platform Alert - {{ .GroupLabels.alertname }}"
      body: |
        <h2>AIOps Learning Platform Alert</h2>
        {{ range .Alerts }}
        <h3>{{ .Annotations.summary }}</h3>
        <p><strong>Description:</strong> {{ .Annotations.description }}</p>
        <p><strong>Severity:</strong> {{ .Labels.severity }}</p>
        <p><strong>Team:</strong> {{ .Labels.team }}</p>
        <p><strong>Status:</strong> {{ .Status }}</p>
        <p><strong>Started:</strong> {{ .StartsAt }}</p>
        {{ if .EndsAt }}
        <p><strong>Ended:</strong> {{ .EndsAt }}</p>
        {{ end }}
        <hr>
        {{ end }}

  - name: webhook-alerts
    type: webhook
    uid: webhook-alerts
    org_id: 1
    is_default: false
    send_reminder: false
    disable_resolve_message: false
    frequency: "10s"
    settings:
      url: "${WEBHOOK_URL}"
      httpMethod: "POST"
      maxAlerts: 0
      title: "AIOps Platform Alert"
      body: |
        {
          "alerts": [
            {{ range $index, $alert := .Alerts }}
            {{ if $index }},{{ end }}
            {
              "summary": "{{ $alert.Annotations.summary }}",
              "description": "{{ $alert.Annotations.description }}",
              "severity": "{{ $alert.Labels.severity }}",
              "team": "{{ $alert.Labels.team }}",
              "status": "{{ $alert.Status }}",
              "startsAt": "{{ $alert.StartsAt }}",
              "endsAt": "{{ $alert.EndsAt }}",
              "labels": {{ $alert.Labels | toJson }}
            }
            {{ end }}
          ]
        }