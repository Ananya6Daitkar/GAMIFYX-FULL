# Secret Scanning Configuration for GamifyX

# Global secret scanning settings
global:
  disable-builtin-rules: false
  custom-patterns: security/trivy/secret-patterns.yaml

# Built-in rules configuration
rules:
  # AWS credentials
  - id: aws-access-key-id
    description: "AWS Access Key ID"
    regex: "AKIA[0-9A-Z]{16}"
    keywords:
      - "aws_access_key_id"
      - "AWS_ACCESS_KEY_ID"
    severity: HIGH
    
  - id: aws-secret-access-key
    description: "AWS Secret Access Key"
    regex: "[A-Za-z0-9/+=]{40}"
    keywords:
      - "aws_secret_access_key"
      - "AWS_SECRET_ACCESS_KEY"
    severity: CRITICAL

  # Database credentials
  - id: database-password
    description: "Database Password"
    regex: "(?i)(password|passwd|pwd)\\s*[=:]\\s*['\"]?[^\\s'\"]{8,}['\"]?"
    keywords:
      - "DB_PASSWORD"
      - "DATABASE_PASSWORD"
      - "POSTGRES_PASSWORD"
      - "MYSQL_PASSWORD"
    severity: HIGH

  # API Keys
  - id: openai-api-key
    description: "OpenAI API Key"
    regex: "sk-[A-Za-z0-9]{48}"
    keywords:
      - "OPENAI_API_KEY"
      - "openai_api_key"
    severity: HIGH

  - id: github-token
    description: "GitHub Personal Access Token"
    regex: "ghp_[A-Za-z0-9]{36}"
    keywords:
      - "GITHUB_TOKEN"
      - "github_token"
    severity: MEDIUM

  # JWT Secrets
  - id: jwt-secret
    description: "JWT Secret Key"
    regex: "(?i)jwt[_-]?secret[_-]?key?\\s*[=:]\\s*['\"]?[A-Za-z0-9+/=]{32,}['\"]?"
    keywords:
      - "JWT_SECRET"
      - "JWT_SECRET_KEY"
      - "jwt_secret"
    severity: HIGH

  # Webhook URLs
  - id: slack-webhook
    description: "Slack Webhook URL"
    regex: "https://hooks\\.slack\\.com/services/[A-Z0-9]{9}/[A-Z0-9]{9}/[A-Za-z0-9]{24}"
    keywords:
      - "SLACK_WEBHOOK"
      - "slack_webhook"
    severity: MEDIUM

  - id: discord-webhook
    description: "Discord Webhook URL"
    regex: "https://discord(?:app)?\\.com/api/webhooks/[0-9]{18}/[A-Za-z0-9_-]{68}"
    keywords:
      - "DISCORD_WEBHOOK"
      - "discord_webhook"
    severity: MEDIUM

  # Private Keys
  - id: rsa-private-key
    description: "RSA Private Key"
    regex: "-----BEGIN RSA PRIVATE KEY-----"
    severity: CRITICAL

  - id: ssh-private-key
    description: "SSH Private Key"
    regex: "-----BEGIN OPENSSH PRIVATE KEY-----"
    severity: CRITICAL

  # GamifyX-specific secrets
  - id: gamifyx-api-key
    description: "GamifyX API Key"
    regex: "gfx_[A-Za-z0-9]{32}"
    keywords:
      - "GAMIFYX_API_KEY"
      - "gamifyx_api_key"
    severity: HIGH

  - id: gamifyx-webhook-secret
    description: "GamifyX Webhook Secret"
    regex: "gfx_webhook_[A-Za-z0-9]{24}"
    keywords:
      - "GAMIFYX_WEBHOOK_SECRET"
      - "gamifyx_webhook_secret"
    severity: MEDIUM

# File patterns to scan for secrets
file-patterns:
  - "**/*.js"
  - "**/*.ts"
  - "**/*.jsx"
  - "**/*.tsx"
  - "**/*.py"
  - "**/*.go"
  - "**/*.java"
  - "**/*.php"
  - "**/*.rb"
  - "**/*.yaml"
  - "**/*.yml"
  - "**/*.json"
  - "**/*.toml"
  - "**/*.ini"
  - "**/*.conf"
  - "**/*.config"
  - "**/*.env*"
  - "**/Dockerfile*"
  - "**/*.dockerfile"
  - "**/*.sh"
  - "**/*.bash"
  - "**/*.zsh"
  - "**/*.fish"

# Files to exclude from secret scanning
exclude-patterns:
  - "node_modules/**"
  - "dist/**"
  - "build/**"
  - "coverage/**"
  - "*.test.*"
  - "*.spec.*"
  - "*.mock.*"
  - "test/**"
  - "tests/**"
  - "__tests__/**"
  - ".git/**"
  - ".github/**"
  - "docs/**"
  - "documentation/**"

# Allowlist for known false positives
allowlist:
  - description: "Example/placeholder secrets in documentation"
    paths:
      - "README.md"
      - "docs/**"
      - "examples/**"
    secrets:
      - "example-secret-key"
      - "your-secret-here"
      - "placeholder-token"

  - description: "Test fixtures and mock data"
    paths:
      - "**/*.test.*"
      - "**/*.spec.*"
      - "test/**"
      - "tests/**"
    secrets:
      - "test-secret"
      - "mock-api-key"
      - "fake-token"

# Severity levels
severity:
  CRITICAL: 
    description: "Secrets that provide full system access"
    examples: ["Private keys", "Root passwords", "Admin tokens"]
  HIGH:
    description: "Secrets that provide significant access"
    examples: ["API keys", "Database passwords", "Service tokens"]
  MEDIUM:
    description: "Secrets with limited scope"
    examples: ["Webhook URLs", "Non-admin tokens"]
  LOW:
    description: "Secrets with minimal impact"
    examples: ["Public API keys", "Read-only tokens"]

# Output configuration
output:
  format: json
  include-raw: false
  show-suppressed: false